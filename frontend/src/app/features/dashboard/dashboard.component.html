<div class="h-screen flex flex-col bg-slate-900 text-white overflow-hidden">
  
  <!-- Top Bar -->
  <header class="h-12 border-b border-slate-700 bg-slate-950 flex items-center justify-between px-4 shrink-0 z-10">
    <div class="flex items-center gap-2">
      <div class="w-6 h-6 bg-indigo-600 rounded flex items-center justify-center font-bold text-xs">OV</div>
      <h1 class="text-sm font-semibold tracking-tight text-slate-200">OpenVeth <span class="text-slate-500 font-normal ml-2">Lab-1</span></h1>
    </div>

    <div class="flex items-center gap-3">
      <div *ngIf="store.isLoading()" class="flex items-center gap-2 text-xs text-blue-400">
        <span class="animate-spin">⟳</span> Saving...
      </div>

      <button (click)="store.syncState()" 
              class="text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded transition-colors flex items-center gap-2">
        <span>↻</span> Sync
      </button>

      <button (click)="store.cleanup()" 
              class="text-xs bg-red-900/30 hover:bg-red-900/50 text-red-400 px-3 py-1.5 rounded border border-red-900/50 transition-colors">
        Cleanup Lab
      </button>
    </div>
  </header>

  <!-- Main Workspace -->
  <div class="flex-1 flex overflow-hidden">
      
      <!-- Left: Component Library (Fixed) -->
      <app-node-palette class="shrink-0" (addNode)="onAddNode($event)"></app-node-palette>

      <!-- Center: Canvas -->
      <div class="flex-1 flex flex-col min-w-0 bg-slate-950 h-full relative">
          <!-- Canvas Area -->
          <div class="flex-1 relative overflow-hidden">
            <app-topology-canvas
                [nodes]="store.topology().nodes"
                [links]="store.topology().links"
                (edgeCreated)="store.addLink($event)"
                (nodeMoved)="store.updateNodePosition($event.id, $event.x, $event.y)"
                (openTerminalRequest)="openTerminal($event)"
                (nodeSelected)="onNodeSelected($event)"
                (linkSelected)="onLinkSelected($event)"
                (nodeDelete)="onDeleteNode($event)"
                (linkDelete)="onDeleteLink($event)">
            </app-topology-canvas>
          </div>
          
          <!-- Integrated Terminal (Only takes space from center) -->
          <div *ngIf="activeTerminals().length > 0" 
               class="h-64 border-t border-slate-700 bg-slate-900 shrink-0 z-10 overflow-hidden">
            <app-terminal-panel 
              [activeNodes]="activeTerminals()" 
              [activeTab]="activeTab()"
              (closeTerminal)="closeTerminal($event)"
              (selectTab)="setActiveTab($event)">
            </app-terminal-panel>
          </div>
      </div>

      <!-- Right: Properties Inspector (Fixed) -->
      <app-properties-panel *ngIf="selectedNode() || selectedLink()" class="shrink-0"
          [selectedNode]="selectedNode()"
          [selectedLink]="selectedLink()"
          (openTerminal)="openTerminal($event)"
          (deleteNode)="onDeleteNode($event)"
          (deleteLink)="onDeleteLink($event)"
          (close)="onNodeSelected(null)">
      </app-properties-panel>
  </div>

  <!-- Global Toasts -->
  <app-toast></app-toast>
</div>
